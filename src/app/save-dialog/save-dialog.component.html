<!-- Save/Publish Dialog -->
<div class="modal-overlay" *ngIf="showDialog" (click)="onOverlayClick()">
  <div class="modal-content" (click)="onContentClick($event)">
    <h3>
      <span class="emoji">{{
        currentSaveMode === "toolbox" ? "💾" : "🏪"
      }}</span>
      {{
        currentSaveMode === "toolbox" ? t("saveToToolbox") : t("addToAppStore")
      }}
    </h3>

    <div class="modal-body">
      <label for="projectName">{{ t("projectName") }}</label>
      <input
        id="projectName"
        [(ngModel)]="projectName"
        type="text"
        class="project-name-input"
        placeholder="Enter project name"
        maxlength="50"
        (keyup.enter)="onEnterKey()"
      />

      <!-- Error message -->
      <div class="error-message" *ngIf="errorMessage">
        <span class="emoji">❌</span>
        {{ errorMessage }}
      </div>

      <div class="modal-info" *ngIf="dialogData">
        <p>
          <strong>{{ t("command") }}:</strong> {{ dialogData.userCommand }}
        </p>
        <p>
          <strong>{{ t("language") }}:</strong>
          {{
            dialogData.currentApp.detectedLanguage === "de"
              ? "German"
              : "English"
          }}
        </p>
      </div>

      <!-- Success message for published apps -->
      <div class="success-message" *ngIf="publishSuccessMessage">
        <span class="emoji">🎉</span>
        {{ publishSuccessMessage }}
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn-secondary" (click)="cancelSave()">
        {{ t("cancel") }}
      </button>

      <!-- Save Button (adapts based on mode) -->
      <button
        class="btn-appstore"
        [ngClass]="
          currentSaveMode === 'toolbox' ? 'btn-toolbox' : 'btn-appstore'
        "
        (click)="
          currentSaveMode === 'toolbox' ? saveToToolbox() : addToAppStore()
        "
        [disabled]="!projectName.trim() || isPublishing"
      >
        <span class="emoji" *ngIf="!isPublishing">{{
          currentSaveMode === "toolbox" ? "💾" : "🏪"
        }}</span>
        <span class="emoji" *ngIf="isPublishing">⏳</span>
        {{
          isPublishing
            ? currentSaveMode === "toolbox"
              ? "Saving..."
              : "Publishing..."
            : currentSaveMode === "toolbox"
            ? "Save to Toolbox"
            : t("addToAppStore")
        }}
      </button>
    </div>
  </div>
</div>
