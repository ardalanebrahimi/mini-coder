<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MiniCoder Analytics Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 5px;
        border-left: 4px solid #007bff;
      }
      .test-button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px 10px 5px 0;
        font-size: 14px;
      }
      .test-button:hover {
        background: #0056b3;
      }
      .analytics-info {
        background: #e7f3ff;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
      }
      .success {
        color: #28a745;
        font-weight: bold;
      }
      .error {
        color: #dc3545;
        font-weight: bold;
      }
      .code {
        background: #f4f4f4;
        padding: 10px;
        border-radius: 3px;
        font-family: monospace;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üìä MiniCoder Analytics System Test</h1>

      <div class="analytics-info">
        <h3>üéØ Analytics System Overview</h3>
        <p>
          <strong>Status:</strong>
          <span class="success">‚úÖ Fully Implemented</span>
        </p>
        <p>
          <strong>Privacy:</strong>
          <span class="success">‚úÖ No PII Collected</span>
        </p>
        <p>
          <strong>Storage:</strong> Local browser storage with optional backend
          sync
        </p>
        <p>
          <strong>Dashboard Access:</strong> Press
          <code>Ctrl + Shift + A</code> in the main app
        </p>
      </div>

      <div class="test-section">
        <h3>üöÄ App Lifecycle Events</h3>
        <p>
          Test events related to app creation, modification, and management:
        </p>
        <button class="test-button" onclick="testAppCreated()">
          Test App Created
        </button>
        <button class="test-button" onclick="testAppModified()">
          Test App Modified
        </button>
        <button class="test-button" onclick="testAppSaved()">
          Test App Saved
        </button>
        <button class="test-button" onclick="testAppPublished()">
          Test App Published
        </button>
      </div>

      <div class="test-section">
        <h3>üé§ Voice & Interaction Events</h3>
        <p>Test voice input and user interaction events:</p>
        <button class="test-button" onclick="testVoiceInput()">
          Test Voice Input
        </button>
        <button class="test-button" onclick="testLanguageChange()">
          Test Language Change
        </button>
        <button class="test-button" onclick="testStarGiven()">
          Test Star Given
        </button>
      </div>

      <div class="test-section">
        <h3>‚ùå Error & System Events</h3>
        <p>Test error tracking and system events:</p>
        <button class="test-button" onclick="testApiError()">
          Test API Error
        </button>
        <button class="test-button" onclick="testAppError()">
          Test App Error
        </button>
        <button class="test-button" onclick="testSessionEvents()">
          Test Session Events
        </button>
      </div>

      <div class="test-section">
        <h3>üìä Analytics Dashboard</h3>
        <p>Access the live analytics dashboard and data management:</p>
        <button class="test-button" onclick="openDashboard()">
          Open Dashboard (Ctrl+Shift+A)
        </button>
        <button class="test-button" onclick="exportData()">
          Export Analytics Data
        </button>
        <button class="test-button" onclick="clearData()">
          Clear All Data
        </button>
      </div>

      <div class="analytics-info">
        <h3>üîß Implementation Details</h3>
        <div class="code">
          // Core Analytics Service Usage import { AnalyticsService,
          AnalyticsEventType } from './services/analytics.service'; // Log app
          creation analytics.logAppCreated('Create a calculator', 'en', true);
          // Log voice input analytics.logVoiceInput('en', 5.2, true); // Log
          custom events analytics.logEvent(AnalyticsEventType.APP_PUBLISHED, {
          appPublished: { appName: 'My App', language: 'en', success: true } });
        </div>
      </div>

      <div class="analytics-info">
        <h3>üîí Privacy & Compliance</h3>
        <ul>
          <li>
            <strong>COPPA Compliant:</strong> No PII collection, safe for kids
          </li>
          <li>
            <strong>GDPR Ready:</strong> Anonymized data, export/delete options
          </li>
          <li><strong>Local First:</strong> Data stays on device by default</li>
          <li>
            <strong>Transparent:</strong> Open dashboard shows all collected
            data
          </li>
        </ul>
      </div>

      <div class="test-section">
        <h3>üìà Event Types Tracked</h3>
        <p><strong>Implemented Events:</strong></p>
        <ul>
          <li>‚úÖ Session Start/End</li>
          <li>‚úÖ App Created/Modified/Rebuilt</li>
          <li>‚úÖ App Published/Saved/Deleted/Played</li>
          <li>‚úÖ Voice Input Used</li>
          <li>‚úÖ Star/Rating Given</li>
          <li>‚úÖ Language Changed</li>
          <li>‚úÖ Auth Login/Logout</li>
          <li>‚úÖ API/App Errors</li>
          <li>‚úÖ Toolbox Opened</li>
        </ul>
      </div>
    </div>

    <script>
      // Simulate analytics events for testing
      // Note: In the real app, these would be called by the AnalyticsService

      function testAppCreated() {
        console.log("üöÄ Analytics Event: APP_CREATED");
        console.log(
          'Details: { prompt: "Create a calculator", language: "en", success: true }'
        );
        alert("‚úÖ App Created event logged! Check console for details.");
      }

      function testAppModified() {
        console.log("üîß Analytics Event: APP_MODIFIED");
        console.log(
          'Details: { modification: "Add dark mode", language: "en", success: true }'
        );
        alert("‚úÖ App Modified event logged! Check console for details.");
      }

      function testAppSaved() {
        console.log("üíæ Analytics Event: APP_SAVED");
        console.log('Details: { appName: "My Calculator", language: "en" }');
        alert("‚úÖ App Saved event logged! Check console for details.");
      }

      function testAppPublished() {
        console.log("üè™ Analytics Event: APP_PUBLISHED");
        console.log(
          'Details: { appName: "My Calculator", language: "en", success: true }'
        );
        alert("‚úÖ App Published event logged! Check console for details.");
      }

      function testVoiceInput() {
        console.log("üé§ Analytics Event: VOICE_INPUT_USED");
        console.log(
          'Details: { language: "en", duration: 4.2, success: true }'
        );
        alert("‚úÖ Voice Input event logged! Check console for details.");
      }

      function testLanguageChange() {
        console.log("üåç Analytics Event: LANGUAGE_CHANGED");
        console.log('Details: { fromLanguage: "en", toLanguage: "de" }');
        alert("‚úÖ Language Change event logged! Check console for details.");
      }

      function testStarGiven() {
        console.log("‚≠ê Analytics Event: STAR_GIVEN");
        console.log('Details: { appId: "123", rating: 1, appLanguage: "en" }');
        alert("‚úÖ Star Given event logged! Check console for details.");
      }

      function testApiError() {
        console.log("‚ùå Analytics Event: API_ERROR");
        console.log(
          'Details: { endpoint: "/api/generate", statusCode: 500, errorMessage: "Server error" }'
        );
        alert("‚úÖ API Error event logged! Check console for details.");
      }

      function testAppError() {
        console.log("üí• Analytics Event: APP_ERROR");
        console.log(
          'Details: { errorMessage: "Failed to render preview", context: "preview_generation" }'
        );
        alert("‚úÖ App Error event logged! Check console for details.");
      }

      function testSessionEvents() {
        console.log("üîÑ Analytics Events: SESSION_START, SESSION_END");
        console.log(
          'Details: { userAgent: "...", referrer: "...", isReturningUser: true }'
        );
        alert("‚úÖ Session events logged! Check console for details.");
      }

      function openDashboard() {
        alert(
          "üí° In the main MiniCoder app, press Ctrl + Shift + A to open the analytics dashboard!\n\nThe dashboard shows:\n‚Ä¢ Real-time event counts\n‚Ä¢ Session duration\n‚Ä¢ Error tracking\n‚Ä¢ Language distribution\n‚Ä¢ Recent events\n‚Ä¢ Data export/clear options"
        );
      }

      function exportData() {
        const sampleData = {
          sessionId: "session_1234567890_abc123",
          events: [
            {
              eventType: "APP_CREATED",
              sessionId: "session_1234567890_abc123",
              userId: "user_abc123",
              language: "en",
              timestamp: new Date().toISOString(),
              details: {
                appCreated: {
                  prompt: "Create a calculator",
                  language: "en",
                  success: true,
                },
              },
            },
          ],
          stats: {
            totalEvents: 1,
            sessionDuration: 300000,
            eventCounts: { APP_CREATED: 1 },
            languageDistribution: { en: 1 },
            errorCount: 0,
          },
          exportedAt: new Date().toISOString(),
        };

        const blob = new Blob([JSON.stringify(sampleData, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `sample-analytics-${
          new Date().toISOString().split("T")[0]
        }.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        alert(
          "‚úÖ Sample analytics data exported! In the real app, this exports actual collected data."
        );
      }

      function clearData() {
        if (
          confirm(
            "Are you sure you want to clear all analytics data? This cannot be undone."
          )
        ) {
          console.log("üóëÔ∏è Analytics data cleared!");
          alert(
            "‚úÖ Analytics data cleared! In the real app, this removes all stored analytics data."
          );
        }
      }

      // Show initial info
      console.log("üìä MiniCoder Analytics System Test Page Loaded");
      console.log("üîß The analytics system is fully implemented with:");
      console.log("   ‚Ä¢ Privacy-first design (no PII)");
      console.log("   ‚Ä¢ Real-time event tracking");
      console.log("   ‚Ä¢ Local storage with size limits");
      console.log("   ‚Ä¢ Analytics dashboard (Ctrl+Shift+A)");
      console.log("   ‚Ä¢ Data export and clearing");
      console.log("   ‚Ä¢ Automatic error tracking");
      console.log("   ‚Ä¢ COPPA and GDPR compliance");
    </script>
  </body>
</html>
