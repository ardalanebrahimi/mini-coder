<!-- Save/Publish Dialog -->
<div class="modal-overlay" *ngIf="showDialog" (click)="onOverlayClick()">
  <div class="modal-content" (click)="onContentClick($event)">
    <h3>
      <span class="emoji">{{
        currentSaveMode === "toolbox" ? "ğŸ’¾" : "ğŸª"
      }}</span>
      {{
        currentSaveMode === "toolbox" ? t("saveToToolbox") : t("addToAppStore")
      }}
    </h3>

    <!-- App Status Info -->
    <div class="app-status" *ngIf="isAppSaved()">
      <div class="status-badge saved">
        <span class="emoji">ğŸ’¾</span>
        <span>App is saved</span>
        <span class="app-name" *ngIf="getCurrentAppName()"
          >"{{ getCurrentAppName() }}"</span
        >
      </div>
      <div class="status-badge published" *ngIf="isAppPublished()">
        <span class="emoji">ğŸŒ</span>
        <span>Already published to App Store</span>
      </div>
    </div>

    <div class="modal-body">
      <label for="projectName">{{ t("projectName") }}</label>
      <input
        id="projectName"
        [(ngModel)]="projectName"
        type="text"
        class="project-name-input"
        placeholder="Enter project name"
        maxlength="50"
        (keyup.enter)="onEnterKey()"
        [readonly]="isAppSaved() && getCurrentAppName()"
      />

      <!-- Error message -->
      <div class="error-message" *ngIf="errorMessage">
        <span class="emoji">âŒ</span>
        {{ errorMessage }}
      </div>

      <div class="modal-info" *ngIf="dialogData">
        <p>
          <strong>{{ t("command") }}:</strong> {{ dialogData.userCommand }}
        </p>
        <p>
          <strong>{{ t("language") }}:</strong>
          {{
            dialogData.currentApp.detectedLanguage === "de"
              ? "German"
              : "English"
          }}
        </p>
      </div>

      <!-- Success message for published apps -->
      <div class="success-message" *ngIf="publishSuccessMessage">
        <span class="emoji">ğŸ‰</span>
        {{ publishSuccessMessage }}
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn-secondary" (click)="cancelSave()">
        {{ t("cancel") }}
      </button>

      <!-- Save Button (adapts based on mode and app status) -->
      <button
        class="btn-appstore"
        [ngClass]="
          currentSaveMode === 'toolbox' ? 'btn-toolbox' : 'btn-appstore'
        "
        (click)="
          currentSaveMode === 'toolbox' ? saveToToolbox() : addToAppStore()
        "
        [disabled]="
          !projectName.trim() ||
          isPublishing ||
          (currentSaveMode === 'appstore' && isAppPublished())
        "
      >
        <span class="emoji" *ngIf="!isPublishing">{{
          currentSaveMode === "toolbox" ? "ğŸ’¾" : "ğŸª"
        }}</span>
        <span class="emoji" *ngIf="isPublishing">â³</span>
        {{
          isPublishing
            ? currentSaveMode === "toolbox"
              ? isAppSaved()
                ? "Updating..."
                : "Saving..."
              : "Publishing..."
            : currentSaveMode === "toolbox"
            ? isAppSaved()
              ? "Update in Toolbox"
              : "Save to Toolbox"
            : isAppPublished()
            ? "Already Published"
            : t("addToAppStore")
        }}
      </button>
    </div>
  </div>
</div>
